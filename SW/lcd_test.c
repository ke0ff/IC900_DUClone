#include <stdint.h>
#include "inc/tm4c123gh6pm.h"
#include "typedef.h"
#include "init.h"
#include "stdio.h"
#include "lcd_db.h"
#include "lcd_test.h"
#include "graphics.h"

void set_cmd(void);
void set_data(void);
void set_FSRV(uint8_t fsrv);
void lreset(void);
void write_d(uint8_t d);
void data_out(uint8_t d);
void comm_out(uint8_t d);
void loop(void);
void setup(void);
void delay(uint16_t dly);
void dispMsmet(uint8_t *lcd_string);
void dispSsmet(uint8_t *lcd_string);
void dispOptrow(uint8_t *lcd_string);

int lcd_test(void)
{
	loop();
	return 0;
}

/****************************************************
*               Hex Table for Image Pic             *
*****************************************************/

/*
uint8_t NHD_Logo [] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xF8,0x01,0xFF,0xF8,0x01,0xFF,0xF8,0x01,0xFF,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x04,0x00,0x02,0x04,0x00,0x02,0x01,0xFF,0xFA,0x05,0xFF,0xF8,0x01,0xFF,0xFA,0x05,0xFF,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0E,0x00,0x07,0x0E,0x00,0x07,0x00,0xFF,0xF7,0x0E,0xFF,0xF0,0x00,0xFF,0xF7,0x0E,0xFF,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x00,0x0F,0x0F,0x00,0x0F,0x00,0x7F,0xEF,0x0F,0x7F,0xE0,0x00,0x7F,0xEF,0x0F,0x7F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x80,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x00,0x00,0x00,0x1F,0x0F,0x80,0x00,0x01,0xF8,0x01,0xF8,0x01,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x00,0x0F,0x0F,0x00,0x0F,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x03,0xFC,0x03,0xFC,0x03,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0E,0xFF,0xF7,0x0E,0xFF,0xF7,0x00,0xFF,0xF7,0x0E,0xFF,0xF0,0x00,0x00,0x07,0x0E,0xFF,0xF0,0x05,0xFA,0x05,0xFA,0x05,0xFA,0x00,0x00,0x00,0x00,0x00,0x00,
	0x05,0xFF,0xFA,0x05,0xFF,0xFA,0x01,0xFF,0xFA,0x05,0xFF,0xF8,0x00,0x00,0x02,0x05,0xFF,0xF8,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x03,0xFF,0xFC,0x00,0x00,0x00,0x03,0xFF,0xFC,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x01,0xFF,0xFA,0x01,0xFF,0xFA,0x01,0xFF,0xFA,0x05,0xFF,0xFA,0x00,0x00,0x02,0x01,0xFF,0xFA,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xF7,0x00,0xFF,0xF7,0x00,0xFF,0xF7,0x0E,0xFF,0xF7,0x00,0x00,0x07,0x00,0xFF,0xF7,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x00,0x0F,0x00,0x00,0x0F,0x0F,0x00,0x0F,0x00,0x00,0x0F,0x00,0x00,0x0F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x04,0x02,0x04,0x02,0x04,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x04,0x02,0x04,0x02,0x04,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0F,0x80,0x1F,0x00,0x00,0x1F,0x00,0x00,0x1F,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x00,0x0F,0x00,0x7F,0xEF,0x0F,0x7F,0xEF,0x00,0x00,0x0F,0x00,0x7F,0xEF,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x07,0x00,0x00,0x07,0x00,0xFF,0xF7,0x0E,0xFF,0xF7,0x00,0x00,0x07,0x00,0xFF,0xF7,0x0E,0x07,0x0E,0x07,0x0E,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x02,0x00,0x00,0x02,0x01,0xFF,0xFA,0x05,0xFF,0xFA,0x00,0x00,0x02,0x01,0xFF,0xFA,0x05,0xFA,0x05,0xFA,0x05,0xFA,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xFC,0x63,0xFF,0xFC,0x00,0x00,0x00,0x03,0xFF,0xFC,0x63,0xFC,0x03,0xFC,0x03,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xF8,0x61,0xFF,0xF8,0x00,0x00,0x00,0x01,0xFF,0xF8,0x61,0xF8,0x01,0xF8,0x01,0xF8,0x00,0x00,0x00,0x00,0x00,0x00

};*/

uint8_t	tarray[] = { "Testing the tester ... quat>" }; // "Test..."

/*
void set_cmd(void){
	VPORTA.OUT |= RS;
	return;
}

void set_data(void){
	VPORTA.OUT &= ~RS;
	return;
}

void set_FSRV(uint8_t fsrv){
	VPORTC.OUT &= ~(FS|RV);
	VPORTC.OUT |= fsrv;
	return;
}

void lreset(void){
	volatile uint8_t	i;
	
	VPORTC.OUT &= ~(nRST);
	for(i=0; i<255; i++);
	VPORTC.OUT |= (nRST);
	return;
}

void write_d(uint8_t d){
	VPORTB.OUT = d;
	VPORTA.OUT &= ~(nWR | nCE);
	VPORTA.OUT |= (nWR | nCE);
	return;
}

void data_out(uint8_t d){
	set_data();
	write_d(d);
}


void comm_out(uint8_t d){
	set_cmd();
	write_d(d);
}
*/

void dispFill(void)
{
	uint16_t i;

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text OFF
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x40, LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON
	for(i=0;i<30720/8;i++)			//fill screen with pixels
	{
		wrdb(0xff, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
	return;
}

void dispClear(void)
{
	uint16_t i;

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text OFF
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x40, LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON
	for(i=0;i<30720/8;i++)			//fill screen with pixels
	{
		wrdb(0x00, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
	return;
}

void dispImage(uint8_t *lcd_string)
{
	uint16_t	i;
//	uint16_t	taddr;
//	uint8_t		j;
	uint8_t*	dp;
/*
//	comm_out(0x98);					//graphics ON, text OFF
	wrdb(0x9C, LCDCMD, STA01);				//graphics ON, text OFF
	wrdb(0x62, LCDDATA, STA01);
	wrdb(0x47, LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

//	data_out(0xff);
//	for(i=0;i<1247;i++)				//pad zeros to reduce array size
//	{
//		data_out(0x00);
//	}
	dp = lcd_string;
	for(i=0;i<MAIN7_LEN;i++)	//fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF*/

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text ON
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x40, LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

	//	data_out(0xff);
//	for(i=0;i<1247;i++)				//pad zeros to reduce array size
//	{
//		data_out(0x00);
//	}
	dp = lcd_string;
	for(i=0;i<MAIN7_LEN;i++)    //fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF

/*	for(i=0;i<1376;i++)		   //pad zeros to reduce array size
	{
		data_out(0x00);
	}*/
//	wrdb(0xB2, LCDCMD);				//auto write OFF
/*	taddr = 0x80b4-30;
	for(j=0; j<11; j+=1){
		wrdb((uint8_t)taddr, LCDDATA, STA01);		//pixel address
		wrdb((uint8_t)(taddr>>8), LCDDATA, STA01);		//pixel address
		wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
		wrdb(0xB0, LCDCMD, STA01);				//auto write ON
		dp = tarray;
		for(i=0;i<sizeof(tarray);i++)    //fill screen with pixels
		{
			wrdb(*dp-0x20, LCDDATA, STA23);		//pixel address
			dp++;
		}
		wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
		taddr += 30;
	}*/
}

void dispImageS(uint8_t *lcd_string)
{
	uint16_t	i;
//	uint16_t	taddr;
//	uint8_t		j;
	uint8_t*	dp;

//	comm_out(0x98);					//graphics ON, text OFF
	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text OFF
	wrdb((U8)(SUB7_OFFS&0xff), LCDDATA, STA01);
	wrdb((U8)(SUB7_OFFS>>8), LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

//	data_out(0xff);
/*	for(i=0;i<1247;i++)				//pad zeros to reduce array size
	{
		data_out(0x00);
	}*/
	dp = lcd_string;
	for(i=0;i<SUB7_LEN;i++)	//fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF

/*	wrdb(0x9C, LCDCMD, STA01);				//graphics ON, text OFF
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x40, LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

	//	data_out(0xff);
//	for(i=0;i<1247;i++)				//pad zeros to reduce array size
//	{
//		data_out(0x00);
//	}
	dp = lcd_string;
	for(i=0;i<MAIN7_LEN;i++)    //fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF*/

	return;
}


void dispMsmet(uint8_t *lcd_string)
{
	uint16_t	i;
	uint8_t*	dp;

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text ON
	wrdb((U8)(MAINSM_OFFS&0xff), LCDDATA, STA01);
	wrdb((U8)(MAINSM_OFFS>>8), LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

	dp = lcd_string;
	for(i=0;i<MAINSM_LEN;i++)    //fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
}

void dispSsmet(uint8_t *lcd_string)
{
	uint16_t	i;
	uint8_t*	dp;

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text ON
	wrdb((U8)(SUBSM_OFFS&0xff), LCDDATA, STA01);
	wrdb((U8)(SUBSM_OFFS>>8), LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

	dp = lcd_string;
	for(i=0;i<SUBSM_LEN;i++)    //fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
}

void dispOptrow(uint8_t *lcd_string)
{
	uint16_t	i;
	uint8_t*	dp;

	wrdb(0x98, LCDCMD, STA01);				//graphics ON, text ON
	wrdb((U8)(OPTROW_OFFS&0xff), LCDDATA, STA01);
	wrdb((U8)(OPTROW_OFFS>>8), LCDDATA, STA01);
	wrdb(0x24, LCDCMD, STA01);				//set address pointer = 0x0040 (first pixel)
	wrdb(0xB0, LCDCMD, STA01);				//auto write ON

	dp = lcd_string;
	for(i=0;i<SUBSM_LEN;i++)    //fill screen with pixels
	{
		wrdb(*dp++, LCDDATA, STA23);
	}
	wrdb(0xB2, LCDCMD, STA01);				//auto write OFF
}

/****************************************************
* Initialization For controller + Setup, to run once*
*****************************************************/

void setup(void)
{
 /* \param[in] dir       PORT_DIR_IN  = Data direction in
 *                      PORT_DIR_OUT = Data direction out
 *                      PORT_DIR_OFF = Disables the pin (low power state)
 */
	GPIO_PORTB_DIR_R = 0;				// port = in
	GPIO_PORTE_DATA_R = nTRD|nTWR|nTCS;
	lcd_cntl(LDSC_RESET);
	wait(100);

//	wrdb(0x40, LCDCMD, STA01);			//text home address

	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x40, LCDDATA, STA01);
	wrdb(0x42, LCDCMD, STA01);			//graphic home address

	wrdb(0x1E, LCDDATA, STA01);
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x41, LCDCMD, STA01);			//text area

	wrdb(0x1E, LCDDATA, STA01);
	wrdb(0x00, LCDDATA, STA01);
	wrdb(0x43, LCDCMD, STA01);			//graphic area
	
	wrdb(0x80, LCDCMD, STA01);			//OR mode
	
	wait(10);
}

/*****************************************************
*           Loop Function, to run repeatedly         *
*****************************************************/

void loop(void)
{
	U8	i;
	U8	j;
	U8	digit_seg[] = { CSEGA|CSEGB|CSEGC|CSEGD|CSEGE|CSEGF,
						CSEGB|CSEGC, CSEGA|CSEGB|CSEGE|CSEGD|CSEGG, CSEGA|CSEGB|CSEGC|CSEGD|CSEGG,
						CSEGF|CSEGB|CSEGC|CSEGG, CSEGA|CSEGF|CSEGC|CSEGD|CSEGG, CSEGA|CSEGC|CSEGD|CSEGE|CSEGF|CSEGG,
						CSEGA|CSEGB|CSEGC, CSEGA|CSEGB|CSEGC|CSEGD|CSEGE|CSEGF|CSEGG, CSEGA|CSEGB|CSEGC|CSEGD|CSEGF|CSEGG,
						0
	};

	setup();
/*	dispFill();
	wait(500); //delay(200);
	dispClear();
	wait(500); //delay(200);*/

	dispClear();
	clear_all();
	dispImage(main7);
	dispImageS(sub7);
	dispMsmet(mainsm);
	dispSsmet(subsm);
	dispOptrow(optrow);

	for(i=0; i<32; i++){
		for(j=0; j<3; j++){
			trig_fill(i, MODE_OR | (1<<j), 1);
			trig_scan1(MODE_OR);
			dispImage(main7);
			dispImageS(sub7);
			dispMsmet(mainsm);
			dispSsmet(subsm);
			dispOptrow(optrow);
			wait(200);
		}
	}
	for(i=0; i<32; i++){
		for(j=0; j<3; j++){
			trig_fill(i, MODE_OR | (1<<j), 2);
			trig_scan2(MODE_OR);
			dispImage(main7);
			dispImageS(sub7);
			dispMsmet(mainsm);
			dispSsmet(subsm);
			dispOptrow(optrow);
			wait(200);
		}
	}
	/*
//	wr_mdigit('1', 0, MDADDR0);
//	wr_mdigit('2', 0, MDADDR1);
	sg_mbcd(CSEGB|CSEGC, MDADDR0, 0, 1);
	sg_mbcd(CSEGA|CSEGB|CSEGG|CSEGE|CSEGD, MDADDR1, 0, 1);
//	sg_mbcd(CSEGP, MDADDR3);
//	sg_mbcd(CSEGP, MDADDR6);

	wr_mdigit('9', 0, MDADDR2);
	wr_mdigit('2', 0, MDADDR3);

	wr_mdigit('0', 0, MDADDR4);
//	wr_mdigit('.', 0, MDADDR4);
	wr_mdigit('0', 0, MDADDR5);
	wr_mdigit('0', 0, MDADDR6);
	wr_mdigit('S', 0, MDADDRS);

	sg_mdp(1);
//	wr_mseg(CSEGP, 0, MDADDR3);
//	wr_mseg(CSEGP, 0, MDADDR0);

	clear_sub7();
	wr_sdigit(' ', 0, SDADDR0, sub7);
	wr_sdigit('4', 0, SDADDR1, sub7);
	wr_sdigit('4', 0, SDADDR2, sub7);
	wr_sdigit('3', 0, SDADDR3, sub7);

//	wr_sdigit('.', 0, SDADDR4, sub7);
	wr_sdigit('6', 0, SDADDR4, sub7);
	wr_sdigit('7', 0, SDADDR5, sub7);
	wr_sdigit('5', 0, SDADDR6, sub7);
	wr_sdigit('S', 0, SDADDRS, sub7);
//	wr_sseg(CSEGP, 0, SDADDR3, sub7);
	disp_fn(2, 1, 0x1a, 0);
//	sg_sdp2(1);

	sg_sbcd(digit_seg[8], MEMMCH_ADDR, 1, 1);
	sg_sbcd(digit_seg[0], MEMMCH_ADDR, 0, 1);
	sg_sbcd(digit_seg[8], MEMSCH_ADDR, 1, 0);
	sg_sbcd(digit_seg[0], MEMSCH_ADDR, 0, 0);

//	wr_sdigit('8', 0, MEMMCH_ADDR, main7);
//	wr_sdigit('8', 0, MEMSCH_ADDR, sub7);
*/
/*	// sub cluster
	sub7[MINSSYM_ADDR] = gdash;
	wr_msym2(*gmem, MEMSYM_X, MEMSYM_Y, 0, MEMSSYM_ADDR, sub7);
	wr_msym2(*gskp, SKPSYM_X, SKPSYM_Y, 0, SKPSSYM_ADDR, sub7);
	wr_sdigit('8', 0, MEMSCH_ADDR, sub7);
	wr_msym2(*gtone, TONESYM_X, TONESYM_Y, 0, TONSSYM_ADDR, sub7);
	wr_msym2(*gdup, DUPSYM_X, DUPSYM_Y, 0, DUPSSYM_ADDR, sub7);

	wr_msym2(*gprog, PROGSYM_X, PROGSYM_Y, 0, PROG_ADDR, sub7);
	wr_msym2(*gband, BANDSYM_X, BANDSYM_Y, 0, BAND_ADDR, sub7);
	wr_msym2(*gsub, SUBSYM_X, SUBSYM_Y, 0, SUB_ADDR, sub7);
	wr_msym2(*glock, LOCKSYM_X, LOCKSYM_Y, 0, LOCK_ADDR, sub7);

	wr_msym2(*gtone, TONESYM_X, TONESYM_Y, 0, TONMSYM_ADDR, main7);
	wr_msym2(*gdup, DUPSYM_X, DUPSYM_Y, 0, DUPMSYM_ADDR, main7);

	main7[MINMSYM_ADDR] = gdash;
	wr_msym2(*gmem, MEMSYM_X, MEMSYM_Y, 0, MEMMSYM_ADDR, main7);
	wr_msym2(*gskp, SKPSYM_X, SKPSYM_Y, 0, SKPMSYM_ADDR, main7);
	wr_sdigit('8', 0, MEMMCH_ADDR, main7);

	// main smet
	wr_msym2(*gsmet1, SM1SYM_X, SM1SYM_Y, 0, MSMET1_ADDR, mainsm);
	wr_msym2(*gsmet2, SM2SYM_X, SM2SYM_Y, 0, MSMET2_ADDR, mainsm);
	wr_msym2(*gsmet3, SM3SYM_X, SM3SYM_Y, 0, MSMET3_ADDR, mainsm);
	wr_msym2(*gsmet4, SM4SYM_X, SM4SYM_Y, 0, MSMET4_ADDR, mainsm);
	wr_msym2(*gsmet5, SM5SYM_X, SM5SYM_Y, 0, MSMET5_ADDR, mainsm);
	wr_msym2(*gsmet6, SM6SYM_X, SM6SYM_Y, 0, MSMET6_ADDR, mainsm);
	wr_msym2(*gsmet7, SM7SYM_X, SM7SYM_Y, 0, MSMET7_ADDR, mainsm);

	// sub smet
	wr_msym2(*gts, TSSYM_X, TSSYM_Y, 0, TS_ADDR, subsm);
	wr_msym2(*gmhz, MHZSYM_X, MHZSYM_Y, 0, MHZ_ADDR, subsm);
	wr_msym2(*gsmet1, SM1SYM_X, SM1SYM_Y, 0, SSMET1_ADDR, subsm);
	wr_msym2(*gsmet2, SM2SYM_X, SM2SYM_Y, 0, SSMET2_ADDR, subsm);
	wr_msym2(*gsmet3, SM3SYM_X, SM3SYM_Y, 0, SSMET3_ADDR, subsm);
	wr_msym2(*gsmet4, SM4SYM_X, SM4SYM_Y, 0, SSMET4_ADDR, subsm);
	wr_msym2(*gsmet5, SM5SYM_X, SM5SYM_Y, 0, SSMET5_ADDR, subsm);
	wr_msym2(*gsmet6, SM6SYM_X, SM6SYM_Y, 0, SSMET6_ADDR, subsm);
	wr_msym2(*gsmet7, SM7SYM_X, SM7SYM_Y, 0, SSMET7_ADDR, subsm);

	// ow/low
	wr_msym2(*gow, OWSYM_X, OWSYM_Y, 0, OW_ADDR, mainsm);
	wr_msym2(*glow, LOWSYM_X, LOWSYM_Y, 0, LOW_ADDR, mainsm);

	// optrow
	wr_msym2(*gvxo, VXOSYM_X, VXOSYM_Y, 0, VXO_ADDR, optrow);
	wr_msym2(*grit, RITSYM_X, RITSYM_Y, 0, RIT_ADDR, optrow);

	wr_msym2(*goptup, OPTUPSYM_X, OPTUPSYM_Y, 0, OPTA_ADDR+UP_ADDR, optrow);
	wr_msym2(*goptdn, OPTDNSYM_X, OPTDNSYM_Y, 0, OPTA_ADDR+DN_ADDR, optrow);
	wr_msym2(*gopttq, OPTASYM_X, OPTASYM_Y, 0, OPTA_ADDR+OPT_ADDR, optrow);

	wr_msym2(*goptup, OPTUPSYM_X, OPTUPSYM_Y, 0, OPTB_ADDR+UP_ADDR, optrow);
	wr_msym2(*goptdn, OPTDNSYM_X, OPTDNSYM_Y, 0, OPTB_ADDR+DN_ADDR, optrow);
	wr_msym2(*goptdq, OPTBSYM_X, OPTBSYM_Y, 0, OPTB_ADDR+OPT_ADDR, optrow);

	wr_msym2(*goptup, OPTUPSYM_X, OPTUPSYM_Y, 0, OPTC_ADDR+UP_ADDR, optrow);
	wr_msym2(*goptdn, OPTDNSYM_X, OPTDNSYM_Y, 0, OPTC_ADDR+DN_ADDR, optrow);
	wr_msym2(*gopt1, OPTCSYM_X, OPTCSYM_Y, 0, OPTC_ADDR+OPT_ADDR, optrow);

	wr_msym2(*goptup, OPTUPSYM_X, OPTUPSYM_Y, 0, OPTD_ADDR+UP_ADDR, optrow);
	wr_msym2(*goptdn, OPTDNSYM_X, OPTDNSYM_Y, 0, OPTD_ADDR+DN_ADDR, optrow);
	wr_msym2(*gopt2, OPTDSYM_X, OPTDSYM_Y, 0, OPTD_ADDR+OPT_ADDR, optrow);
*/
/*	wr_ssym2(*gsmet1, SM1SYM_X, SM1SYM_Y, 0, SSMET1_ADDR);
	wr_ssym2(*gsmet2, SM2SYM_X, SM2SYM_Y, 0, SSMET2_ADDR);
	wr_ssym2(*gsmet3, SM3SYM_X, SM3SYM_Y, 0, SSMET3_ADDR);
	wr_ssym2(*gsmet4, SM4SYM_X, SM4SYM_Y, 0, SSMET4_ADDR);
	wr_ssym2(*gsmet5, SM5SYM_X, SM5SYM_Y, 0, SSMET5_ADDR);
	wr_ssym2(*gsmet6, SM6SYM_X, SM6SYM_Y, 0, SSMET6_ADDR);
	wr_ssym2(*gsmet7, SM7SYM_X, SM7SYM_Y, 0, SSMET7_ADDR);*/
/*
	for(j=0; j<20; j++){
		i = j&1;
		sg_mmin(i);
		sg_smin(i);
		sg_mdup(i);
		sg_sdup(i);
		sg_mtne(i);
		sg_stne(i);
		sg_mmem(i);
		sg_smem(i);
		sg_mskp(i);
		sg_sskp(i);
		sg_mm0(i);
		sg_mm1(i);
		sg_mm2(i);
		sg_mm3(i);
		sg_mm4(i);
		sg_mm5(i);
		sg_mm6(i);
		sg_sm0(i);
		sg_sm1(i);
		sg_sm2(i);
		sg_sm3(i);
		sg_sm4(i);
		sg_sm5(i);
		sg_sm6(i);
		sg_ow(i);
		sg_low(i);
		sg_ts(i);
		sg_mhz(i);
		sg_prg(i);
		sg_bnd(i);
		sg_sub(i);
		sg_lck(i);
		sg_vxo(i);
		sg_rit(i);
		sg_mss(i);
		sg_tss(i);
		sg_tsq(i);
		sg_dsm(i);
		sg_dss(i);
		sg_dsq(i);
		sg_op1m(i);
		sg_op1s(i);
		sg_op1(i);
		sg_op2m(i);
		sg_op2s(i);
		sg_op2(i);

		sg_sbcd(digit_seg[8], MEMMCH_ADDR, 1, 1);
		sg_sbcd(digit_seg[8], MEMSCH_ADDR, 1, 0);
		sg_sbcd(digit_seg[j>>1], MEMMCH_ADDR, 0, 1);
		sg_sbcd(digit_seg[j>>1], MEMSCH_ADDR, 0, 0);

		dispImage(main7);
		dispImageS(sub7);
		dispMsmet(mainsm);
		dispSsmet(subsm);
		dispOptrow(optrow);
		wait(200);
	}
*/
/*	wait(200);
	wr_mseg(SEGB, 1, MDADDR0);
	dispImage(main7);
	wr_mseg(SEGC, 1, MDADDR0);
	dispImage(main7);

	wr_mseg(SEGA, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGB, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGG, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGE, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGD, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGC, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGG, 1, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGF, 0, MDADDR0);
	dispImage(main7);
	wait(200);
	wr_mseg(SEGDP, 0, MDADDR0);
	dispImage(main7);
	wait(200);

	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGB, 1, MDADDR0);
	dispImageS(sub7);
	wr_sseg(SEGC, 1, MDADDR0);
	dispImageS(sub7);

	wr_sseg(SEGA, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGB, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGG, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGE, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGD, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGC, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGG, 1, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGF, 0, MDADDR0);
	dispImageS(sub7);
	wait(200);
	wr_sseg(SEGDP, 0, MDADDR0);
	dispImageS(sub7);*/

//	wait(1000); //delay(4000);
//	dispClear();
//	delay(1000);
	return;
}


void delay(uint16_t dly){
	volatile uint16_t	i;
	volatile uint8_t	j;
	
//	dly *= 65;
	for(i=0; i<dly; i++){
		for(j=0; j<255; j++);
	}
	return;
}
